# Upstream Service Configuration
upstream django-service {
    server django-service:8000;
}

upstream minio-service {
    server minio-service:9000;
}

# Main Server Configuration
server {
    # Server Port Configuration
    listen 8080;

    # Maximum Upload Size Configuration
    client_max_body_size 20M;

    # Error Logging Configuration
    error_log /var/log/nginx/error.log error;

    # Proxy Header Configuration
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Proxy Performance Settings
    proxy_http_version 1.1;
    proxy_buffering off;

    # Django Service Proxy
    location /api/ {
        proxy_pass http://django-service/api/;
        access_log /var/log/nginx/django_access.log;
        error_log /var/log/nginx/django_error.log error;
    }

    # Django Admin Proxy
    location /admin/ {
        proxy_pass http://django-service/admin/;
        access_log /var/log/nginx/django_access.log;
        error_log /var/log/nginx/django_error.log error;
    }

    # Django Health Check Proxy
    location /health/ {
        proxy_pass http://django-service/health/;
        access_log /var/log/nginx/health_access.log;
        error_log /var/log/nginx/health_error.log error;
    }

    # Silk Service Proxy
    location /silk/ {
        proxy_pass http://django-service/silk/;
        access_log /var/log/nginx/silk_access.log;
        error_log /var/log/nginx/silk_error.log error;
    }

    # Minio Service Proxy
    location /minio/ {
        proxy_pass http://minio-service/;
        access_log /var/log/nginx/minio_access.log;
        error_log /var/log/nginx/minio_error.log error;
    }
}
